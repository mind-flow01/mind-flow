generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  PSICOLOGO
  PACIENTE
}

enum Gender {
  MASCULINO
  FEMININO
  OUTRO
}


enum PatientStatus {
  ATIVO
  ACOMPANHAMENTO
  ALTA
  INATIVO
}

enum AccountStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ConsultaStatus {
  CONFIRMADO
  CANCELADO
  A_CONFIRMAR
}

enum TranscricaoStatus {
  PENDENTE
  PROCESSANDO
  CONCLUIDA
  ERRO
}


model User {
  id             String        @id @default(cuid())
  name           String
  email          String        @unique
  emailHash      String?       @unique
  password       String
  photo_url      String?
  phone          String?
  role           Role
  account_status AccountStatus @default(ACTIVE)
  created_at     DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  psicologo      Psicologo?
  paciente       Paciente?
}

model Psicologo {
  userId String @id
  user   User   @relation(fields: [userId], references: [id])
  crp               String  @unique
  crpHash           String? @unique
  bio               String?
  schedule_settings Json? 

  pacientes Paciente[] @relation("PsicologoResponsavel")
}

model Paciente {
  userId String @id
  user   User   @relation(fields: [userId], references: [id])
  cpf                  String?     @unique
  cpfHash              String?     @unique
  gender               Gender
  initial_observations String?
  history              String?
  status               PatientStatus @default(ATIVO)

  psicologo_responsavel_id String? 
  psicologo_responsavel    Psicologo?  @relation("PsicologoResponsavel", fields: [psicologo_responsavel_id], references: [userId])
  
  consultas Consulta[]
}

model Consulta {
  id            String        @id @default(cuid())
  paciente_id   String
  paciente      Paciente      @relation(fields: [paciente_id], references: [userId])
  horario       DateTime
  tipo          String
  categoria     String
  tags          String[]
  status        ConsultaStatus @default(A_CONFIRMAR)
  sugestao_IA   String?
  transcricao_id String?
  created_at    DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Transcricao {
  id            String           @id @default(cuid())
  texto_gerado  String?
  data_geracao  DateTime         @default(now())
  status        TranscricaoStatus @default(PENDENTE)
  created_at    DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
}